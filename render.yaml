# render.yaml
# Render.com ìë™ ë°°í¬ ì„¤ì • íŒŒì¼
# FastAPI ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ìœ„í•œ ìµœì í™”ëœ ì„¤ì •

services:
  # ì›¹ ì„œë¹„ìŠ¤ ì •ì˜
  - type: web
    name: youtube-translator-kr  # ì„œë¹„ìŠ¤ ì´ë¦„ (URLì— í¬í•¨ë¨)
    runtime: python
    region: singapore  # í•œêµ­ì—ì„œ ê°€ì¥ ê°€ê¹Œìš´ ë¦¬ì „
    plan: free  # ë¬´ë£Œ í”Œëœ (ì›” 750ì‹œê°„)
    
    # Python ë²„ì „ ëª…ì‹œì  ì§€ì •
    buildFilter:
      paths:
        - app/**
        - requirements.txt
        - render.yaml
    
    # ë¹Œë“œ ì„¤ì •
    buildCommand: |
      # Python í™˜ê²½ ì„¤ì •
      echo "ğŸ”§ Python ë²„ì „ í™•ì¸..."
      python --version
      
      # pip ì—…ê·¸ë ˆì´ë“œ ë° íŒ¨í‚¤ì§€ ì„¤ì¹˜
      echo "ğŸ“¦ íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..."
      pip install --upgrade pip
      pip install -r requirements.txt
      
      # gunicorn ì„¤ì¹˜ í™•ì¸ (requirements.txtì— ì—†ì„ ê²½ìš° ëŒ€ë¹„)
      pip install gunicorn
      
      # í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸ (ë””ë²„ê¹…ìš©)
      echo "ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡° í™•ì¸..."
      ls -la
      ls -la app/
    
    # ì„œë²„ ì‹œì‘ ëª…ë ¹ì–´ (ìˆ˜ì •ë¨!)
    startCommand: |
      # âœ… gunicornìœ¼ë¡œ FastAPI ì•± ì‹¤í–‰
      # app ë””ë ‰í† ë¦¬ì˜ main.py íŒŒì¼ì—ì„œ app ê°ì²´ë¥¼ ì°¾ìŠµë‹ˆë‹¤
      echo "ğŸš€ ì„œë²„ ì‹œì‘ ì¤‘..."
      echo "í¬íŠ¸: $PORT"
      gunicorn app.main:app \
        --bind 0.0.0.0:$PORT \
        --workers 1 \
        --worker-class uvicorn.workers.UvicornWorker \
        --timeout 120 \
        --access-logfile - \
        --error-logfile - \
        --log-level info
    
    # í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
    envVars:
      # Gemini API í‚¤ (Render ëŒ€ì‹œë³´ë“œì—ì„œ ì„¤ì •)
      - key: GEMINI_API_KEY
        sync: false  # ë³´ì•ˆì„ ìœ„í•´ ëŒ€ì‹œë³´ë“œì—ì„œ ìˆ˜ë™ ì…ë ¥
        
      # Python ë²„ì „ ì§€ì • (3.11 ê¶Œì¥)
      - key: PYTHON_VERSION
        value: "3.11"
        
      # íƒ€ì„ì¡´ ì„¤ì • (í•œêµ­ ì‹œê°„)
      - key: TZ
        value: Asia/Seoul
        
      # ë¡œê·¸ ë ˆë²¨
      - key: LOG_LEVEL
        value: info
        
      # FastAPI í™˜ê²½ ì„¤ì •
      - key: ENVIRONMENT
        value: production
        
      # CORS ì„¤ì • (ë°°í¬ í›„ ì‹¤ì œ ë„ë©”ì¸ìœ¼ë¡œ ë³€ê²½ í•„ìš”)
      - key: ALLOWED_ORIGINS
        value: "*"  # ì´ˆê¸°ì—ëŠ” ëª¨ë“  ë„ë©”ì¸ í—ˆìš©
        
      # ì›Œì»¤ íƒ€ì„ì•„ì›ƒ (ì´ˆ)
      - key: WORKER_TIMEOUT
        value: "120"
    
    # í—¬ìŠ¤ì²´í¬ ì„¤ì •
    healthCheckPath: /health
    healthCheckInterval: 300  # 5ë¶„ë§ˆë‹¤ ì²´í¬
    
    # ìë™ ë°°í¬ ì„¤ì •
    autoDeploy: true  # main ë¸Œëœì¹˜ í‘¸ì‹œ ì‹œ ìë™ ë°°í¬
    
    # ë¹Œë“œ í™˜ê²½ ì„¤ì •
    buildEnvVars:
      - key: PYTHON_VERSION
        value: "3.11"
